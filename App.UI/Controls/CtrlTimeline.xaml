<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="JpegViewer.App.UI.Controls.CtrlTimeline"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:JpegViewer.App.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:vms="using:JpegViewer.App.Vmd.Controls"
    xmlns:models="using:JpegViewer.App.Core.Models"
    xmlns:support="using:JpegViewer.App.UI.Support"
    xmlns:types="using:JpegViewer.App.Core.Types"
    mc:Ignorable="d"
    Height="300">

    <UserControl.Resources>
        <Style TargetType="TextBlock" x:Name="TimelineTextStyle">
            <Setter Property="Margin" Value="0 4 0 4"/>
            <Setter Property="HorizontalTextAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="{StaticResource colorIconForeground}"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable"/>
            <Setter Property="FontSize" Value="13.5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <StackLayout x:Key="HorizontalStackLayout" Orientation="Horizontal"/>

        <DataTemplate x:Name="TimelineItemTemplate" x:DataType="models:TimelineItem">
            <Grid PointerPressed="Item_PointerPressed"
                  PointerMoved="Item_PointerMoved"
                  PointerReleased="Item_PointerReleased"
                  PointerCanceled="Item_PointerCanceled"
                  Background="{StaticResource colorTimelineItemBackground}"
                  Tag="{x:Bind}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Margin="8 4 0 4"
                           HorizontalAlignment="Left"
                           Text="{x:Bind support:StringFormatter.TimelineItemHeaderText(ItemType, ItemKey)}"
                           Style="{StaticResource TimelineTextStyle}"/>
                <Border BorderThickness="2" BorderBrush="{StaticResource colorTimelineItemBorder}" VerticalAlignment="Bottom"/>

                <ItemsRepeater x:Name="innerItemsRepeater" Grid.Row="1" ItemsSource="{x:Bind Units}" Layout="{StaticResource HorizontalStackLayout}"
                               ElementPrepared="itemsRepeater_ElementPrepared">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="models:TimelineItemBaseUnit">
                            <Grid MinWidth="{Binding DataContext.MinItemsWidth, ElementName=itemsRepeater}"
                                  Width="{Binding DataContext.ItemsWidth, ElementName=itemsRepeater}"
                                  Background="{x:Bind support:XamlBindHelpers.GetAlternationColor(support:XamlBindHelpers.ColorBrushA, support:XamlBindHelpers.ColorBrushB)}"
                                  Tag="{x:Bind}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="{x:Bind support:StringFormatter.TimeLineItemUnitText(Type, Value)}" Style="{StaticResource TimelineTextStyle}"/>
                                <FontIcon Grid.Row="1"
                                          FontSize="32"
                                          Glyph="{x:Bind support:XamlBindHelpers.GetPictureIconBasedOnCount(Images)}"
                                          Visibility="{x:Bind support:XamlBindHelpers.CountToVisibility(Images)}"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
                <Border Grid.RowSpan="3" BorderThickness="1" BorderBrush="{StaticResource colorTimelineItemBorder}" HorizontalAlignment="Left"/>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Grid x:Name="root" Background="{StaticResource colorControlBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Margin="16 0 0 8" Text="Timeline view of pictures" FontSize="16" HorizontalAlignment="Left" Foreground="{StaticResource colorForeground}"/>
        <TextBlock Margin="0 4 0 8" HorizontalAlignment="Center" Text="{Binding CurrentTime}" Foreground="{StaticResource colorIconForeground}"/>
        <Border BorderThickness="1" VerticalAlignment="Bottom"/>
        
        <ScrollViewer x:Name="scrollViewer" Grid.Row="1"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled"
                      IsVerticalScrollChainingEnabled="False"
                      ViewChanged="scrollViewer_ViewChanged"
                      LayoutUpdated="scrollViewer_LayoutUpdated"
                      AnchorRequested="scrollViewer_AnchorRequested">
            <ItemsRepeater x:Name="itemsRepeater"
                           ItemsSource="{Binding Items}"
                           ItemTemplate="{StaticResource TimelineItemTemplate}"
                           Layout="{StaticResource HorizontalStackLayout}"
                           PointerWheelChanged="ItemsRepeater_PointerWheelChanged"/>
        </ScrollViewer>        
        <Border Grid.Row="1" HorizontalAlignment="Center" BorderThickness="1" PointerWheelChanged="ItemsRepeater_PointerWheelChanged"/>
        <Rectangle Grid.Row="2" Fill="{StaticResource colorControlBackground}"/>
        <Border Grid.Row="2" VerticalAlignment="Top" BorderThickness="1"/>
        <StackPanel Grid.Row="2" Margin="0 9 0 8" Orientation="Horizontal" HorizontalAlignment="Center">
            <FontIcon FontSize="40"
                      Glyph="&#xf08d;"
                      PointerEntered="FontIcon_PointerEntered"
                      PointerExited="FontIcon_PointerExited"
                      PointerPressed="FontIcon_PointerPressed"
                      PointerReleased="FontIcon_PointerReleased"/>
            <FontIcon Margin="16 0 16 0"
                      FontSize="40"
                      Glyph="&#xe786;"
                      PointerEntered="FontIcon_PointerEntered"
                      PointerExited="FontIcon_PointerExited"
                      PointerPressed="FontIcon_PointerPressed"
                      PointerReleased="FontIcon_PointerReleased"/>
            <FontIcon FontSize="40"
                      Glyph="&#xf08f;"
                      PointerEntered="FontIcon_PointerEntered"
                      PointerExited="FontIcon_PointerExited"
                      PointerPressed="FontIcon_PointerPressed"
                      PointerReleased="FontIcon_PointerReleased"/>
        </StackPanel>
    </Grid>
</UserControl>
